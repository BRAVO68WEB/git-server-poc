# Stasis Server Configuration

server:
  host: "0.0.0.0"
  port: 8080
  mode: "debug"  # debug, release, test
  hosted_url: "https://git.example.com" # Public URL where the server is hosted

database:
  host: "localhost"
  port: 5432
  user: "stasis"
  password: "password"
  dbname: "stasis"
  sslmode: "disable"

storage:
  type: "filesystem"  # filesystem, s3
  base_path: "./data/repos"
  # S3 configuration (only used when type is "s3")
  # s3_bucket: "git-repos"
  # s3_region: "us-east-1"
  # s3_access_key: ""
  # s3_secret_key: ""
  # s3_endpoint: ""  # For S3-compatible services like MinIO

ssh:
  enabled: true
  host: "0.0.0.0"
  port: 2222
  host_key_path: "./ssh_host_key"

# OIDC (OpenID Connect) Authentication
# Configure your OIDC provider (e.g., Google, Keycloak, Auth0, Okta)
oidc:
  enabled: false
  # OIDC provider's issuer URL (e.g., https://accounts.google.com, https://keycloak.example.com/realms/myrealm)
  issuer_url: ""
  # OAuth2 client ID from your OIDC provider
  client_id: ""
  # OAuth2 client secret from your OIDC provider (use env var STASIS_OIDC_CLIENT_SECRET in production)
  client_secret: ""
  # Callback URL where the OIDC provider will redirect after authentication
  redirect_url: "http://localhost:8080/api/v1/auth/oidc/callback"
  # Frontend URL for redirecting after OIDC callback
  frontend_url: "http://localhost:3000"
  # OIDC scopes to request (default: openid, profile, email)
  scopes:
    - "openid"
    - "profile"
    - "email"
  # Secret for signing session JWTs (use env var STASIS_OIDC_JWT_SECRET in production)
  jwt_secret: "change-this-secret-in-production"

# Logging Configuration
# Supports three output modes: console, file, or otel (OpenTelemetry)
logging:
  # Log level: debug, info, warn, error
  level: "info"

  # Output destination: console, file, or otel
  # - console: Logs to stdout (default)
  # - file: Logs to a file with rotation support
  # - otel: Sends logs to an OpenTelemetry collector
  output: "console"

  # Log format: json or console
  # - json: Structured JSON format (recommended for production)
  # - console: Human-readable format (recommended for development)
  format: "json"

  # Enable development mode for more verbose output and colored console logs
  development: false

  # Add caller information (file:line) to log entries
  add_caller: true

  # File output configuration (only used when output is "file")
  # Path to the log file
  file_path: "./logs/stasis.log"
  # Maximum size of log file in megabytes before rotation
  file_max_size_mb: 100
  # Maximum number of old log files to retain
  file_max_backups: 3
  # Maximum number of days to retain old log files
  file_max_age_days: 28
  # Compress rotated log files using gzip
  file_compress: true

  # OpenTelemetry (OTEL) configuration (only used when output is "otel")
  otel:
    # Enable OTEL logging
    enabled: false
    # OTEL collector endpoint (gRPC or HTTP)
    # For gRPC: "localhost:4317"
    # For HTTP: "localhost:4318"
    endpoint: "localhost:4317"
    # Service name for OTEL
    service_name: "stasis"
    # Service version
    service_version: "1.0.0"
    # Deployment environment (e.g., development, staging, production)
    environment: "development"
    # Use insecure connection (no TLS) - set to false in production
    insecure: true
    # Additional headers to send with OTEL requests (e.g., for authentication)
    # headers:
    #   Authorization: "Bearer your-token"
    #   X-Custom-Header: "value"

mirror:
  enabled: true      # Enable automatic syncing
  sync_interval: 1h  # Sync every hour (configurable: 30m, 2h, etc.)
