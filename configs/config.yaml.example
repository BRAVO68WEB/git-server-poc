# Git Server Configuration

server:
  host: "0.0.0.0"
  port: 8080
  mode: "debug"  # debug, release, test
  hosted_url: "https://git.example.com" # Public URL where the server is hosted

database:
  host: "localhost"
  port: 5432
  user: "stasis"
  password: "password"
  dbname: "stasis"
  sslmode: "disable"

storage:
  type: "filesystem"  # filesystem, s3
  base_path: "./data/repos"
  # S3 configuration (only used when type is "s3")
  # s3_bucket: "git-repos"
  # s3_region: "us-east-1"
  # s3_access_key: ""
  # s3_secret_key: ""
  # s3_endpoint: ""  # For S3-compatible services like MinIO

ssh:
  enabled: true
  host: "0.0.0.0"
  port: 2222
  host_key_path: "./ssh_host_key"

# OIDC (OpenID Connect) Authentication
# Configure your OIDC provider (e.g., Google, Keycloak, Auth0, Okta)
oidc:
  enabled: false
  # OIDC provider's issuer URL (e.g., https://accounts.google.com, https://keycloak.example.com/realms/myrealm)
  issuer_url: ""
  # OAuth2 client ID from your OIDC provider
  client_id: ""
  # OAuth2 client secret from your OIDC provider (use env var STASIS_OIDC_CLIENT_SECRET in production)
  client_secret: ""
  # Callback URL where the OIDC provider will redirect after authentication
  redirect_url: "http://localhost:8080/api/v1/auth/oidc/callback"
  # OIDC scopes to request (default: openid, profile, email)
  scopes:
    - "openid"
    - "profile"
    - "email"
  # Secret for signing session JWTs (use env var STASIS_OIDC_JWT_SECRET in production)
  jwt_secret: "change-this-secret-in-production"

# OPA (Open Policy Agent) Authorization
# Uses the embedded OPA Go SDK - no external server required
opa:
  enabled: false
  # Path to the Rego policy file
  policy_path: "./policies/rbac.rego"
  # OPA query to evaluate (default: data.stasis.authz.allow)
  query: "data.stasis.authz.allow"

logging:
  level: "info"  # debug, info, warn, error
  output_path: "stdout"  # stdout, stderr, or file path
  format: "json"  # json, console
